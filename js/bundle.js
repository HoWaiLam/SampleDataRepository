let i={home:{destination:new Cesium.Cartesian3(-2453145.5202967487,5469149.680380916,2448924.8412507917),orientation:{up:new Cesium.Cartesian3(.15567657383863612,-.3470721475786586,.9248274048345462),direction:new Cesium.Cartesian3(.378493379193893,.8438296573594657,.38038700196904063)}}};function A(){var e=document.createElement("div");return e.id="cesiumContainer",document.body.appendChild(e),e}function t(){return new Cesium.OpenStreetMapImageryProvider({fileExtension:"png",minimumLevel:0,maximumLevel:18,url:"https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/imagery/WGS84"})}function n(){return new Cesium.OpenStreetMapImageryProvider({fileExtension:"png",minimumLevel:0,maximumLevel:18,url:"https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/basemap/WGS84"})}function o(){var e=[];return e.push(new Cesium.ProviderViewModel({name:"Imagery Map",iconUrl:"assets/mapboxSatellite.png",creationFunction:t})),e.push(new Cesium.ProviderViewModel({name:"Topographic Map",iconUrl:"assets/openStreetMap.png",creationFunction:n})),e}function r(e){e.scene.primitives.primitiveAdded.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceAdded.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceMoved.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceRemoved.addEventListener(function(){e.scene.requestRender()})}function a(e){e=e.scene.globe;e.baseColor=Cesium.Color.BLACK,e.depthTestAgainstTerrain=!0,e.enableLighting=!0,e.preloadSiblings=!0,e.tileCacheSize=250}function l(e){e=e.scene.fog;e.density=.001,e.minimumBrightness=.85,e.visualDensityScalar=.45}function s(e){let t=e.scene.camera;null!=e.homeButton&&((e=e.homeButton.viewModel.command.beforeExecute).removeEventListener(e._listeners[0]),e.addEventListener(function(e){e.cancel=!0,t.flyTo(i.home)}))}function e(){var e=o(),e=new Cesium.Viewer("map",{animation:!1,baseLayerPicker:!0,contextOptions:{allowTextureFilterAnisotropic:!1,webgl:{antialias:!1,premultipliedAlpha:!0}},fullscreenButton:!0,geocoder:!1,homeButton:!0,imageryProviderViewModels:e,infoBox:!0,msaaSamples:4,navigationHelpButton:!1,orderIndependentTranslucency:!1,projectionPicker:!1,requestRenderMode:!0,resolutionScale:1,sceneMode:Cesium.SceneMode.SCENE2D,sceneModePicker:!1,shadows:!1,shouldAnimate:!1,showFog:!1,selectedImageryProviderViewModel:e[1],terrainProviderViewModels:[],timeline:!1,useBrowserRecommendedResolution:!1,vrButton:!1});return r(e),a(e),l(e),s(e),e}function u(){return e()}let c="assets/img/marker.png",d=30,h=new Cesium.Color(1,1,0,.25),T=Cesium.Color.YELLOW,m=Cesium.Color.RED,f=5,p=Cesium.Color.WHITE,y=2.5;async function v(e){var t;try{t=await fetch(e)}catch(e){}return t?.ok?t.json():{}}function g(n){return new Promise(function(e,t){let i=new Image;i.onload=function(){e(i)},i.onerror=t,i.src=n})}async function w(e){return Cesium.GeoJsonDataSource.load(e)}function C(e){return void 0===e.name&&void 0!==e.source?e.source.split("/").pop().split(".")[0]:e.name}function E(e){return new Cesium.Color(Cesium.Math.clamp(e[0]/255,0,1),Cesium.Math.clamp(e[1]/255,0,1),Cesium.Math.clamp(e[2]/255,0,1),e[3])}function b(e){let t={},i=e.values;return Object.keys(i).forEach(function(e){t[e]=new Cesium.ColorMaterialProperty(E(i[e]))}),t}function M(e,t,i){let n=i[t?.path??c],o=t?.height??d,r=o/n.height;e.forEach(function(e){e.billboard.image=n,e.billboard.height=o,e.billboard.width=n.width*r})}function L(e,t,i){}function P(e,t,i){if(!(t=t?.image)||t?.discreateValue)return L(e,t,i);M(e,t,i)}function S(e){return new Cesium.PolylineOutlineMaterialProperty({color:e.color?E(e.color):m,outlineColor:e.outline.color?E(e.outline.color):p,outlineWidth:e.outline.width??y})}function k(e){let t=e.outline.color?E(e.outline.color):p,i=e.outline.width??y,n=e.discreateValue.values,o={};return Object.keys(n).forEach(function(e){o[e]=new Cesium.PolylineOutlineMaterialProperty({color:E(n[e]),outlineColor:t,outlineWidth:i})}),o}function B(e,t){let i=t.discreateValue.attribute,n=S(t),o=k(t),r=t?.width??f;e.forEach(function(e){e.polyline.material=o[e.properties[i]]??n,e.polyline.width=r})}function V(e,t){let i=S(t),n=t?.width??f;e.forEach(function(e){e.polyline.material=i,e.polyline.width=n})}function x(e,t){if(t.discreateValue)return B(e,t);V(e,t)}function O(e,t){let i=t.discreateValue,n=i.attribute,o=b(i),r=new Cesium.ColorMaterialProperty(t.color?E(t.color):m),a=t?.width??f;e.forEach(function(e){e.polyline.material=o[e.properties[n]]??r,e.polyline.width=a})}function I(e,t){let i=new Cesium.ColorMaterialProperty(t?.color?E(t.color):m),n=t?.width??f;e.forEach(function(e){e.polyline.material=i,e.polyline.width=n})}function R(e,t){if(t.discreateValue)return O(e,t);I(e,t)}function z(e,t){if(t?.outline)return x(e,t);R(e,t)}function D(e,t){let i=t.discreateValue,n=b(i),o=new Cesium.ColorMaterialProperty(t.color?E(t.color):h),r=i.attribute;e.forEach(function(e){e.polygon.material=n[e.properties[r]]??o})}function j(e,t){let i=new Cesium.ColorMaterialProperty(t?.color?E(t.color):h);e.forEach(function(e){e.polygon.material=i})}function q(e,t){if((t=t.fill)?.discreateValue)return D(e,t);j(e,t)}function F(e,n){if(void 0===(n=n.outline))e.forEach(function(e){e.polygon.outline=!1});else{let t=E(n.color??h),i=n.width??2.5;e.forEach(function(e){e.polygon.outline=!0,e.polygon.outlineColor=t,e.polygon.outlineWidth=i})}}function N(e,t){q(e,t),F(e,t)}function G(e,t,i){if(void 0!==t&&0!==(e=e.entities.values).length)return e[0].billboard?P(e,t,i):e[0].polyline?z(e,t):e[0].polygon?N(e,t):void 0}class H{constructor(){this.t=void 0,this.i=void 0,this.l=!1,this.o=void 0,this.u=void 0,this.m={},this.h=void 0,this.C=void 0}get name(){return this.o}get element(){return this.i}get initialized(){return this.l}async g(){console.info("Loading data source for",this.o),this.P=!0;var e=await w(this.u.source);G(e,this.u.symbology,this.m),e.show=!0,this.t=e,this.h.raiseEvent(e),this.P=!1}S(e){let t=this,i=document.getElementById("toc-layer-template").content.firstElementChild.cloneNode(!0),n=(i.getElementsByClassName("toc-layer-name")[0].innerHTML=t.name,i.getElementsByClassName("toc-layer-checkbox-container")[0].children[0]);n.checked=!1,n.addEventListener("change",async function(){void 0===t.t?t.P||await t.g():(t.t.show=t.i.getElementsByClassName("toc-layer-checkbox-container")[0].children[0].checked,t.C.raiseEvent())}),this.i=i}async p(e){var t=await g(e=e?.path??c);this.m[e]=t}async v(e){if(e=e?.discreateValue){let i=this,t=e.values,n=Object.keys(t),o=[];for(let e=0;e<n.length;e++)o.push(g(t[key]));Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)i.m[n[e]]=img})}}async O(e){e=e?.symbology?.image,await this.p(e),await this.v(e)}async initialize(e,t,i){e.source&&(this.u=e,this.o=C(e),this.h=t,this.C=i,this.S(e),await this.O(e),this.l=!0)}}class _{constructor(){this.D=[],this.M=this.B(),this.k=new Cesium.Event,this.L=new Cesium.Event}B(){return document.getElementById("table-of-content")}async F(e){var t=new H;return await t.initialize(e,this.k,this.L),t}W(t){this.k.addEventListener(function(e){console.info("Adding data source",e.name),t.dataSources.add(e)})}_(e){this.L.addEventListener(function(){e.scene.requestRender()})}async initialize(e){var t=document.getElementById("toc-layers"),i=(await v(e))?.mapLayers;if(void 0!==i)for(let e=0;e<i.length;e++){var n=await this.F(i[e]);n.initialized&&(this.D.push(n),t.appendChild(n.element))}}get(e){return this.D[e]}async load(e){this.W(e),this._(e)}}function U(e){let t=new _;return t.initialize("data/MapLayers.json").then(function(){t.load(e)}),t}function J(e){e.scene.camera.setView(i.home)}var W,K;window.onload=function(){W=u(),K=U(W),J(W)};