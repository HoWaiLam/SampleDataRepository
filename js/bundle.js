let i={home:{destination:new Cesium.Cartesian3(-2453145.5202967487,5469149.680380916,2448924.8412507917),orientation:{up:new Cesium.Cartesian3(.15567657383863612,-.3470721475786586,.9248274048345462),direction:new Cesium.Cartesian3(.378493379193893,.8438296573594657,.38038700196904063)}}};function W(){var e=document.createElement("div");return e.id="cesiumContainer",document.body.appendChild(e),e}function t(){return new Cesium.OpenStreetMapImageryProvider({fileExtension:"png",minimumLevel:0,maximumLevel:18,url:"https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/imagery/WGS84"})}function n(){return new Cesium.OpenStreetMapImageryProvider({fileExtension:"png",minimumLevel:0,maximumLevel:18,url:"https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/basemap/WGS84"})}function o(){var e=[];return e.push(new Cesium.ProviderViewModel({name:"Imagery Map",iconUrl:"assets/mapboxSatellite.png",creationFunction:t})),e.push(new Cesium.ProviderViewModel({name:"Topographic Map",iconUrl:"assets/openStreetMap.png",creationFunction:n})),e}function r(e){e.scene.primitives.primitiveAdded.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceAdded.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceMoved.addEventListener(function(){e.scene.requestRender()}),e.dataSources.dataSourceRemoved.addEventListener(function(){e.scene.requestRender()})}function a(e){e=e.scene.globe;e.baseColor=Cesium.Color.BLACK,e.depthTestAgainstTerrain=!0,e.enableLighting=!0,e.preloadSiblings=!0,e.tileCacheSize=250}function l(e){e=e.scene.fog;e.density=.001,e.minimumBrightness=.85,e.visualDensityScalar=.45}function s(e){let t=e.scene.camera;null!=e.homeButton&&((e=e.homeButton.viewModel.command.beforeExecute).removeEventListener(e._listeners[0]),e.addEventListener(function(e){e.cancel=!0,t.flyTo(i.home)}))}function e(){var e=o(),e=new Cesium.Viewer("map",{animation:!1,baseLayerPicker:!0,contextOptions:{allowTextureFilterAnisotropic:!1,webgl:{antialias:!1,premultipliedAlpha:!0}},fullscreenButton:!0,geocoder:!1,homeButton:!0,imageryProviderViewModels:e,infoBox:!0,msaaSamples:4,navigationHelpButton:!1,orderIndependentTranslucency:!1,projectionPicker:!1,requestRenderMode:!1,resolutionScale:1,sceneMode:Cesium.SceneMode.SCENE2D,sceneModePicker:!1,shadows:!1,shouldAnimate:!1,showFog:!1,selectedImageryProviderViewModel:e[1],terrainProviderViewModels:[],timeline:!1,useBrowserRecommendedResolution:!1,vrButton:!1});return r(e),a(e),l(e),s(e),e}function u(){return e()}let c="assets/img/marker.png",d=30,h=new Cesium.Color(1,1,0,.25),D=Cesium.Color.YELLOW,m=Cesium.Color.RED,p=5,f=Cesium.Color.WHITE,y=2.5;async function w(e){var t=new DecompressionStream("gzip"),e=(await(await fetch(e)).blob()).stream().pipeThrough(t),t=await(await new Response(e).blob()).text();return JSON.parse(t)}async function v(e){var t;try{t=await fetch(e)}catch(e){}return t?.ok?t.json():{}}function g(n){return new Promise(function(e,t){let i=new Image;i.onload=function(){e(i)},i.onerror=t,i.src=n})}async function C(e){return e=await w(e),Cesium.GeoJsonDataSource.load(e)}async function E(e){return Cesium.GeoJsonDataSource.load(e)}async function b(e){return("gz"==e.split(".").pop()?C:E)(e)}function M(e){return void 0===e.name&&void 0!==e.source?e.source.split("/").pop().split(".")[0]:e.name}function S(e){return new Cesium.Color(Cesium.Math.clamp(e[0]/255,0,1),Cesium.Math.clamp(e[1]/255,0,1),Cesium.Math.clamp(e[2]/255,0,1),e[3])}function L(e){let t={},i=e.values;return Object.keys(i).forEach(function(e){t[e]=new Cesium.ColorMaterialProperty(S(i[e]))}),t}function P(e,t,i){let n=i[t?.path??c],o=t?.height??d,r=o/n.height;e.forEach(function(e){e.billboard.image=n,e.billboard.height=o,e.billboard.width=n.width*r})}function k(e,t,i){}function B(e,t,i){if(!(t=t?.image)||t?.discreateValue)return k(e,t,i);P(e,t,i)}function V(e){return new Cesium.PolylineOutlineMaterialProperty({color:e.color?S(e.color):m,outlineColor:e.outline.color?S(e.outline.color):f,outlineWidth:e.outline.width??y})}function x(e){let t=e.outline.color?S(e.outline.color):f,i=e.outline.width??y,n=e.discreateValue.values,o={};return Object.keys(n).forEach(function(e){o[e]=new Cesium.PolylineOutlineMaterialProperty({color:S(n[e]),outlineColor:t,outlineWidth:i})}),o}function O(e,t){let i=t.discreateValue.attribute,n=V(t),o=x(t),r=t?.width??p;e.forEach(function(e){e.polyline.material=o[e.properties[i]]??n,e.polyline.width=r})}function z(e,t){let i=V(t),n=t?.width??p;e.forEach(function(e){e.polyline.material=i,e.polyline.width=n})}function R(e,t){if(t.discreateValue)return O(e,t);z(e,t)}function I(e,t){let i=t.discreateValue,n=i.attribute,o=L(i),r=new Cesium.ColorMaterialProperty(t.color?S(t.color):m),a=t?.width??p;e.forEach(function(e){e.polyline.material=o[e.properties[n]]??r,e.polyline.width=a})}function A(e,t){let i=new Cesium.ColorMaterialProperty(t?.color?S(t.color):m),n=t?.width??p;e.forEach(function(e){e.polyline.material=i,e.polyline.width=n})}function F(e,t){if(t.discreateValue)return I(e,t);A(e,t)}function j(e,t){if(t?.outline)return R(e,t);F(e,t)}function q(e,t){let i=t.discreateValue,n=L(i),o=new Cesium.ColorMaterialProperty(t.color?S(t.color):h),r=i.attribute;e.forEach(function(e){e.polygon.material=n[e.properties[r]]??o})}function N(e,t){let i=new Cesium.ColorMaterialProperty(t?.color?S(t.color):h);e.forEach(function(e){e.polygon.material=i})}function J(e,t){if((t=t.fill)?.discreateValue)return q(e,t);N(e,t)}function G(e,n){if(void 0===(n=n.outline))e.forEach(function(e){e.polygon.outline=!1});else{let t=S(n.color??h),i=n.width??2.5;e.forEach(function(e){e.polygon.outline=!0,e.polygon.outlineColor=t,e.polygon.outlineWidth=i})}}function H(e,t){J(e,t),G(e,t)}function _(e,t,i){if(void 0!==t&&0!==(e=e.entities.values).length)return e[0].billboard?B(e,t,i):e[0].polyline?j(e,t):e[0].polygon?H(e,t):void 0}class U{constructor(){this.t=void 0,this.i=void 0,this.o=!1,this.l=void 0,this.u=void 0,this.m={},this.h=void 0,this.C=void 0,this.g=void 0}get name(){return this.l}get element(){return this.i}get initialized(){return this.o}async p(){this.P=!0;var e=await b(this.u.source);_(e,this.u.symbology,this.m),e.show=!0,this.t=e,this.h.raiseEvent(e),this.P=!1}S(e){let t=this,i=document.getElementById("toc-layer-template").content.firstElementChild.cloneNode(!0),n=(i.getElementsByClassName("toc-layer-name")[0].innerHTML=t.name,i.getElementsByClassName("toc-layer-checkbox-container")[0].children[0]);n.checked=!1,n.addEventListener("change",function(){t.t?(t.t.show=t.i.getElementsByClassName("toc-layer-checkbox-container")[0].children[0].checked,t.C.raiseEvent()):t.P||t.p()}),this.i=i}async v(e){var t=await g(e=e?.path??c);this.m[e]=t}async O(e){if(e=e?.discreateValue){let i=this,t=e.values,n=Object.keys(t),o=[];for(let e=0;e<n.length;e++)o.push(g(t[key]));Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)i.m[n[e]]=img})}}async D(e){e=e?.symbology?.image,await this.v(e),await this.O(e)}async initialize(e,t,i){e.source&&(this.u=e,this.l=M(e),this.h=t,this.C=i,this.S(e),await this.D(e),this.o=!0)}}class K{constructor(){this.F=[],this.M=this.B(),this.k=new Cesium.Event,this.L=new Cesium.Event}B(){return document.getElementById("table-of-content")}async W(e){var t=new U;return await t.initialize(e,this.k,this.L),t}_(t){this.k.addEventListener(function(e){t.dataSources.add(e)})}J(e){this.L.addEventListener(function(){e.scene.requestRender()})}async initialize(e){var t=document.getElementById("toc-layers"),i=(await v(e))?.mapLayers;if(void 0!==i)for(let e=0;e<i.length;e++){var n=await this.W(i[e]);n.initialized&&(this.F.push(n),t.appendChild(n.element))}}get(e){return this.F[e]}async load(e){this._(e),this.J(e)}}function Y(e){let t=new K;return t.initialize("data/MapLayers.json").then(function(){t.load(e)}),t}function Q(e){e.scene.camera.setView(i.home)}var T,X;window.onload=function(){T=u(),X=Y(T),Q(T)};